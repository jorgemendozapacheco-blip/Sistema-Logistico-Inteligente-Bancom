{# Aplicaciones/Academico/templates/inventario.html #}
{% extends "base.html" %}

{% block title %}Inventario{% endblock %}

{% block body %}
<style>
    /* TABLA COMPACTA */
    .compact-table th,
    .compact-table td {
        padding: .25rem .3rem !important;
        line-height: 1 !important;
        font-size: 0.65rem !important;
    }
</style>

<div class="container-fluid px-0 py-1">
    <h1 class="text-white mb-1" style="font-size:1.25rem; padding-left:.5rem;">
        Inventario de Items
    </h1>

    {% if messages %}
    {% for m in messages %}
    <div class="alert alert-{{ m.tags }} py-1 my-1" style="font-size:0.85rem; padding-left:.5rem;">
        {{ m }}
    </div>
    {% endfor %}
    {% endif %}

    {# Formulario de Importar Excel #}
    <form method="post" action="{% url 'academico:inventario' %}" enctype="multipart/form-data" class="mb-1"
        style="padding-left:.5rem;">
        {% csrf_token %}
        <div class="row gx-1 gy-1 align-items-center">
            <div class="col-auto">
                <input type="file" name="excel_file" accept=".xls,.xlsx" class="form-control form-control-sm"
                    style="font-size:0.75rem;" required>
            </div>
            <div class="col-auto d-grid">
                <button type="submit" class="btn btn-success btn-sm" style="font-size:0.75rem; padding:.25rem .5rem;">
                    Importar Excel
                </button>
            </div>
        </div>
    </form>

    {# Botón Limpiar Tabla con confirm() #}
    <div class="mb-2" style="padding-left:.5rem;">
        <form method="post" action="{% url 'academico:clear_inventario' %}"
            onsubmit="return confirm('¿Estás seguro de que deseas limpiar todo el inventario?');"
            style="display:inline-block;">
            {% csrf_token %}
            <button type="submit" class="btn btn-warning btn-sm" style="font-size:0.75rem; padding:.25rem .5rem;">
                Limpiar tabla
            </button>
        </form>
    </div>

    {# Tabla de inventario #}
    <div class="table-responsive bg-white p-1 rounded" style="overflow-x:auto; padding-left:.5rem;">
        <table id="inventarioTable" class="table table-sm compact-table mb-0 w-100">
            <thead class="table-dark">
                <tr>
                    <th>#</th>
                    <th>Código</th>
                    <th>Hostname</th>
                    <th>Serie</th>
                    <th>Estado</th>
                    <th>Motivo</th>
                    <th>Nombre</th>
                    <th>Modelo</th>
                    <th>Marca</th>
                    <th>Proveedor</th>
                    <th>Localidad</th>
                    <th>Oficina</th>
                    <th>Piso</th>
                    <th>Adquisición</th>
                    <th>CPU</th>
                    <th>Disco (GB)</th>
                    <th>OS</th>
                    <th>IP</th>
                    <th>RAM</th>
                    <th>Empleado</th>
                    <th>Departamento</th>
                </tr>
            </thead>
            <tbody>
                {% for it in items %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ it.codigo }}</td>
                    <td>{{ it.etiqueta }}</td>
                    <td>{{ it.numerodeserie }}</td>
                    <td>{{ it.estado }}</td>
                    <td>{{ it.motivo_estado }}</td>
                    <td>{{ it.nombre }}</td>
                    <td>{{ it.modelo }}</td>
                    <td>{{ it.marca }}</td>
                    <td>{{ it.proveedor }}</td>
                    <td>{{ it.localidad_limpia }}</td>
                    <td>{{ it.oficina }}</td>
                    <td>{{ it.piso }}</td>
                    <td>{{ it.fecha_adquisicion }}</td>
                    <td>{{ it.cpu_type }}</td>
                    <td>{{ it.disk_gb }}</td>
                    <td>{{ it.os_arch }} {{ it.os_name }}</td>
                    <td>{{ it.ip_address }}</td>
                    <td>{{ it.ram_gb }}</td>
                    <td>{{ it.empleado }}</td>
                    <td>{{ it.dept_per }}</td>
                </tr>
                {% empty %}
                <tr class="text-center">
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>No hay items.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{# SCRIPTS #}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<script>
    $(document).ready(function () {
        // Inicializar DataTable
        $('#inventarioTable').DataTable({
            paging: true,
            searching: true,
            autoWidth: false
        });

        // Ocultar alertas después de 5 segundos
        setTimeout(function () {
            $('.alert').fadeOut('slow');
        }, 5000);
    });
</script>
{% endblock %}